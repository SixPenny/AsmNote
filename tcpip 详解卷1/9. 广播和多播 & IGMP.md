## 广播和多播

1. 广播和多播近应用于 UDP
2. 辨析
    - 目的地址指明单个接收接口，即发往明确的目的主机，称为单播
    - 一个主机向网上的所有主机发送帧，称为广播
    - 帧仅传送给属于多播组的主机，称为多播
3. 数据帧的过滤过程
    1. 网卡查看信道传送来的帧，确定是否接收，通常只接收目的地址为网卡物理地址或广播地址的帧（物理地址的多播地址为：01:00:00:00:00:00， 广播地址：ff:ff:ff:ff:ff:ff）
    2. 设备驱动程序接收到帧后，查看帧类型是否有指定的协议，进行多播过滤来检测该主机是否属于多播地址说明的多播组，如果不符合，就丢弃
    3. IP 根据IP地址中的源地址和目的地址进行过滤，检验首部检验和
    4. UDP 收到IP传送过来的数据报，就根据源端口号和目的端口号进行过滤，如果不存在进程使用该目的端口，就发送ICMP不可达差错；检验和错就直接丢弃该帧
4. 使用广播的问题：数据报需要到达 UDP 层才能检测到没有端口对广播帧感兴趣，处理成本高
5. 广播
    - 类型
        - 受限的广播
            - 地址：255.255.255.255
            - 用于主机配置过程中IP 数据报的目的地址
        - 指向网络的广播
            - 地址为主机号全为1 的地址
            - 路由器必须转发，但可以配置不转发
        - 指定子网的广播
            - 地址为主机号全为1且有特定子网号的地址
            - 需要根据子网掩码来计算子网广播地址
        - 指定所有子网的广播
            - 地址为子网号及主机号全为1的地址
            - 也需要了解子网掩码
            - 如果划分了子网，地址就是指定所有子网的广播，如果没有，就是一个广播地址
    - 实践
        - `ping broadcast address`，某些主机不允许ping 广播地址，需要使用 `-b` 选项
        - arp 会缓存所有应答主机
6. 多播
    - 多播组地址为D类地址
    - 能够接收发往一个特定多播组地址的主机集合称为主机组
        - 主机组成为可随时加入、离开
        - 主机数量没有限制
        - 不属于某主机组的主机可以向该组发送消息
    - 知名地址
        - 224.0.0.1 代表该子网内所有系统组
        - 224.0.0.2 代表该子网内所有路由器组
        - 224.0.1.1 用作网络时间协议 NTP
        - 224.0.0.9 用作 RIP-2
    - 过程
        - 多播发送进程将IP地址指明为多播地址，设备驱动程序将其转换为对应的以太网地址，把数据发送出去
        - 接收进程必须先通知IP层，它想接收的发往给定多播地址的数据报，IP 层通知设备驱动程序，这个过程称为加入一个多播组
        - 当需要使用路由器转发多播数据报时，需要IGMP协议

## IGMP

1. Internet 组管理协议
2. 让一个物理网络上的所有系统知道主机当前所在的多播组，多播路由器需要知道信息以便确定多播数据报向哪个接口转发
3. IGMP 报文格式
    - ![](https://note.youdao.com/yws/public/resource/7892244109fc75f249e4a20f1c461bdc/xmlnote/5CD87EB441574978950464753D1F95FA/19670)
    - IGMP 是定长的，没有可选数据
4. IGMP 协议
    1. 加入一个多播组
        - 多播的基础是进程的概念
        - 在主机给定的接口上加入一个多播组
    2. 报告和查询
        - 当第一个进程加入一个组时，主机就发送一个IGMP报告；如果多个进程加入一个组，只发送一个IGMP报告
        - 当进程离开一个多播组时，主机不发送 IGMP 报文，即使是最后一个主机离开
        - 多播路由器定时发送IGMP 查询来了解是否还有任何主机包含属于多播组的进程。多播路由器向所有接口均发送查询报文
        - 主机通过发送 IGMP 报告响应一个 IGMP 查询，对含有进程的多播组发回一个 IGMP 报告
    3. IGMP 报告和查询均设置TTL 为1，限定数据报仅在子网中传输
    4. 从 `224.0.0.0` 到 `224.0.0.255` 的地址空间是打算用于多播范围不超过1跳的应用，不管 TTL 是多少，多播路由器均不转发这些目的地址的数据报
    5. 所有主机组：224.0.0.1, 设计在一个物理网络中所有具备多播能力的主机和路由器
