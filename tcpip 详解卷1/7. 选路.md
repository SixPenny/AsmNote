## IP 选路

1. 选路机制搜索路由表并决定向哪个接口发送分组
2. 选路策略是一组决定将哪些路由放入路由表的规则
    - 路由守护程序提供的
3. 查看路由表
    - route 或 netstat -rn
    - U: 表示该路由可用
    - G：表示该路由到一个网关，可以分辨是直接路由还是间接路由。如果没有，说明直接相连
    - H：该路由是到一个主机。即目的地址是一个完整的主机地址，如果没有，说明是一个网络地址，网络号或网络号+子网号
    - D：该路由是由重定向报文创建的
    - M：该路由被重定向报文修改
4. 在路由没有匹配表项的情况下
    - 即没有默认路由
    - 如果是主机里产生的（即没有可用的出口），则给应用返回一个差错
    - 如果是被转发报文，则返回给发送端一个 ICMP 主机不可达差错
5. ICMP 重定向差错
    - 当IP 数据报应当被发送到另一个路由器上时，收到数据报的路由器就要发送 ICMP 重定向报文给源端。（即另一个路由器是更好的选路选择）
    - 重定向报文用来没让具有很少路由信息的主机逐渐建立完善的路由信息
    - ICMP 重定向报文只能创建主机路由，而不能创建网络路由
    - 报文只能由路由器产生，只能由主机使用

## 动态选路协议

1. 用于路由之间的通信
2. 动态选路协议用于路由器之间交换路由信息，这只会改变路由表中的路由项，而不是改变选路机制。
3. 不同的选路协议
    - Internet 是由一组自治系统组成的
    - 在自治系统内部，可以选择自己的选路协议，称为 IGP(Interior Group Protocol),常用 RIP
    - 在自治系统之间，EGP 用于外部网关协议
4. Unix 选路守护程序
    - 这是在路由器上使用的，主机上没有
    - routed 路由守护程序
    - 只能使用 RIP
5. RIP 选路
    - 报文格式，封装在 UDP 数据报中
    - ![](http://www.023wg.com/message/message/image/rip-format-rip1.png)
    - 解释见 [RIP报文格式](http://www.023wg.com/message/message/cd_feature_rip_format.html)
    - 运行
        - 初始化：在每一个启动了的端口上发送请求报文。点对点链路中请求直接发送给另一段；支持广播协议的网络中，发送广播请求。使用的UDP 端口号 520。
        - 收到请求：处理路由器中的每一个表项，发回响应
        - 收到响应：crud 路由器表项
        - 定期选路更新：每过30s，所有或部分路由器会将其完整的路由信息发送给相邻的路由器
        - 触发更新：每当一条路由的度量发生变化后，路由器就发送变化的表项给相邻路由器
